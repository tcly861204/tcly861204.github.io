var shut=[{map:[[2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,4,1,1,1,3,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2]],box:[{x:5,y:3}],person:{x:3,y:3}},{map:[[0,0,0,2,2,2,0,0],[0,0,0,2,4,2,0,0],[2,2,2,2,1,2,0,0],[2,4,1,1,1,2,2,2],[2,2,2,1,1,1,4,2],[0,0,2,1,2,2,2,2],[0,0,2,4,2,0,0,0],[0,0,2,2,2,0,0,0]],box:[{x:2,y:3},{x:4,y:3},{x:4,y:4},{x:3,y:5}],person:{x:3,y:4}},{map:[[2,2,2,2,2,0,0,0,0],[2,1,1,1,2,0,0,0,0],[2,1,1,1,2,0,2,2,2],[2,1,1,1,2,0,2,4,2],[2,2,2,1,2,2,2,4,2],[0,2,2,1,1,1,1,4,2],[0,2,1,1,1,2,1,1,2],[0,2,1,1,1,2,2,2,2],[0,2,2,2,2,2,0,0,0]],box:[{x:2,y:2},{x:2,y:3},{x:3,y:2}],person:{x:1,y:1}},{map:[[0,2,2,2,2,2,2,2,0,0],[0,2,1,1,1,1,1,2,2,2],[2,2,1,2,2,2,1,1,1,2],[2,1,1,1,1,1,1,1,1,2],[2,1,4,4,2,1,1,1,2,2],[2,2,4,4,2,1,1,1,2,0],[0,2,2,2,2,2,2,2,2,0]],box:[{x:2,y:2},{x:4,y:3},{x:7,y:3},{x:6,y:4}],person:{x:2,y:3}},{map:[[0,2,2,2,2,0],[2,2,1,1,2,0],[2,1,1,1,2,0],[2,2,1,1,2,2],[2,2,1,1,1,2],[2,4,1,1,1,2],[2,4,4,3,4,2],[2,2,2,2,2,2]],box:[{x:2,y:2},{x:2,y:3},{x:2,y:5},{x:3,y:4}],person:{x:1,y:2}},{map:[[0,2,2,2,2,2,0,0],[0,2,1,1,2,2,2,0],[0,2,1,1,1,1,2,0],[2,2,2,1,2,1,2,2],[2,4,2,1,2,1,1,2],[2,4,1,1,1,2,1,2],[2,4,1,1,1,1,1,2],[2,2,2,2,2,2,2,2]],box:[{x:3,y:2},{x:2,y:5},{x:5,y:6}],person:{x:2,y:1}},{map:[[0,0,0,2,2,2,2,2,2,2],[0,0,2,2,1,1,2,1,1,2],[0,0,2,1,1,1,2,1,1,2],[0,0,2,1,1,1,1,1,1,2],[0,0,2,1,1,2,2,1,1,2],[2,2,2,1,1,1,2,1,2,2],[2,4,4,4,4,4,1,1,2,0],[2,2,2,2,2,2,2,2,2,0]],box:[{x:3,y:3},{x:5,y:3},{x:7,y:3},{x:4,y:4},{x:4,y:5}],person:{x:8,y:1}},{map:[[0,0,0,2,2,2,2,2,2,0],[0,2,2,2,1,1,1,1,2,0],[2,2,4,1,1,2,2,1,2,2],[2,4,4,1,1,1,1,1,1,2],[2,4,4,1,1,1,1,1,2,2],[2,2,2,2,2,2,1,1,2,0],[0,0,0,0,0,2,2,2,2,0]],box:[{x:4,y:2},{x:3,y:3},{x:5,y:3},{x:4,y:4},{x:6,y:4}],person:{x:8,y:3}},{map:[[0,2,2,2,2,2,2,2,2,2,0],[0,2,1,1,2,2,1,1,1,2,0],[0,2,1,1,1,1,1,1,1,2,0],[0,2,1,1,2,2,2,1,1,2,0],[0,2,1,2,4,4,4,2,1,2,0],[2,2,1,2,4,4,4,2,1,2,2],[2,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,2,1,1,1,2],[2,2,2,2,2,2,2,2,2,2,2]],box:[{x:2,y:3},{x:5,y:2},{x:8,y:3},{x:2,y:6},{x:5,y:6},{x:8,y:6}],person:{x:8,y:7}}],Game={shut:shut,pass:0,W:27,H:27,init:function(){this.parentNode=document.getElementById("game"),this.levelNode=document.getElementById("level"),this.moveNode=document.getElementById("moves"),this.pusheNode=document.getElementById("pushes");var a=this.parentNode.getElementsByTagName("img");if(a.length){for(var b=a.length;b>0;)this.parentNode.removeChild(a[0]),b--;this.pass++}this.levelNode.innerText=this.pass+1,this.moveNode.innerText=0,this.pusheNode.innerText=0,this.createMap(),this.disArr=[];for(var b=0;b<this.shut[this.pass].map.length;b++)for(var c=0;c<this.shut[this.pass].map[b].length;c++)if(4===this.shut[this.pass].map[b][c]){var d=c+"^"+b;this.disArr.push(d)}},createMap:function(){this.parentNode.style.width=this.shut[this.pass].map[0].length*this.W+"px",this.parentNode.style.height=this.shut[this.pass].map.length*this.H+"px",this.parentNode.style.left=(document.documentElement.clientWidth-this.shut[this.pass].map[0].length*this.W)/2+"px",this.parentNode.style.top=(document.documentElement.clientHeight-this.shut[this.pass].map.length*this.H)/2-34+"px";for(var a=0;a<this.shut[this.pass].map.length;a++)for(var b=0;b<this.shut[this.pass].map[a].length;b++)this.showBox(a,b,this.shut[this.pass].map[a][b]);this.createBox()},createBox:function(){for(var a=0;a<this.shut[this.pass].box.length;a++)this.showBox(this.shut[this.pass].box[a].y,this.shut[this.pass].box[a].x,5,"box");this.createPerson()},createPerson:function(){var a=document.createElement("img");a.style.top=this.shut[this.pass].person.y*this.W+"px",a.style.left=this.shut[this.pass].person.x*this.H+"px",a.className="pull",a.setAttribute("data-run-x",this.shut[this.pass].person.x),a.setAttribute("data-run-y",this.shut[this.pass].person.y),this.parentNode.appendChild(a),this.eventKey(a)},runPerson:function(a,b){var c=1*a.getAttribute("data-run-x"),d=1*a.getAttribute("data-run-y"),e=c,f=d,g=this;switch(b){case"L":if(e=c-1,g.checkMove(e,f)){a.style.left=e*g.W+"px",a.setAttribute("data-run-x",e),this.moveNode.innerText=1*this.moveNode.innerText+1;var h=g.getBoxPact(a);if(h.checkBox)if(!g.isBoxdis(f,e-1)||1!==this.shut[this.pass].map[f][e-1]&&4!==this.shut[this.pass].map[f][e-1])a.style.left=(e+1)*g.W+"px",a.setAttribute("data-run-x",e+1),this.moveNode.innerText=1*this.moveNode.innerText-1;else{var i=h.ImgNode;i[0].style.left=(1*i[1]-1)*g.W+"px",i[0].setAttribute("box-dis-x",1*i[1]-1),this.pusheNode.innerText=1*this.pusheNode.innerText+1,g.checkPass()}}break;case"T":if(f=d-1,g.checkMove(e,f)){a.style.top=f*g.H+"px",a.setAttribute("data-run-y",f),this.moveNode.innerText=1*this.moveNode.innerText+1;var h=g.getBoxPact(a);if(h.checkBox)if(!g.isBoxdis(f-1,e)||1!==this.shut[this.pass].map[f-1][e]&&4!==this.shut[this.pass].map[f-1][e])a.style.top=(f+1)*g.W+"px",a.setAttribute("data-run-y",f+1),this.moveNode.innerText=1*this.moveNode.innerText-1;else{var i=h.ImgNode;i[0].style.top=(1*i[2]-1)*g.H+"px",i[0].setAttribute("box-dis-y",1*i[2]-1),this.pusheNode.innerText=1*this.pusheNode.innerText+1,g.checkPass()}}break;case"R":if(e=c+1,g.checkMove(e,f)){a.style.left=e*g.W+"px",a.setAttribute("data-run-x",e),this.moveNode.innerText=1*this.moveNode.innerText+1;var h=g.getBoxPact(a);if(h.checkBox)if(!g.isBoxdis(f,e+1)||1!==this.shut[this.pass].map[f][e+1]&&4!==this.shut[this.pass].map[f][e+1])a.style.left=(e-1)*g.W+"px",a.setAttribute("data-run-x",e-1),this.moveNode.innerText=1*this.moveNode.innerText-1;else{var i=h.ImgNode;i[0].style.left=(1*i[1]+1)*g.W+"px",i[0].setAttribute("box-dis-x",1*i[1]+1),this.pusheNode.innerText=1*this.pusheNode.innerText+1,g.checkPass()}}break;case"D":if(f=d+1,g.checkMove(e,f)){a.style.top=f*g.H+"px",a.setAttribute("data-run-y",f),this.moveNode.innerText=1*this.moveNode.innerText+1;var h=g.getBoxPact(a);if(h.checkBox)if(!g.isBoxdis(f+1,e)||1!==this.shut[this.pass].map[f+1][e]&&4!==this.shut[this.pass].map[f+1][e])a.style.top=(f-1)*g.W+"px",a.setAttribute("data-run-y",f-1),this.moveNode.innerText=1*this.moveNode.innerText-1;else{var i=h.ImgNode;i[0].style.top=(1*i[2]+1)*g.H+"px",i[0].setAttribute("box-dis-y",1*i[2]+1),this.pusheNode.innerText=1*this.pusheNode.innerText+1,g.checkPass()}}}},checkPass:function(){for(var a=this.getBoxArr(),b=0,c=this,d=0;d<a.length;d++){var e=1*a[d][0].getAttribute("box-dis-x"),f=1*a[d][0].getAttribute("box-dis-y"),g=e+"^"+f;this.disArr.indexOf(g)>-1&&b++}if(b===this.disArr.length){var h=0,i=null;i=setInterval(function(){10===h&&(clearInterval(i),alert("恭喜您！"),c.init()),h++;for(var b=0;b<a.length;b++)h%2?a[b][0].src="images/3.jpg":a[b][0].src="images/5.jpg"},100)}},isBoxdis:function(a,b){for(var c=0,d=this.getBoxArr(),e=0;e<d.length;e++)d[e][0].getAttribute("box-dis-x")===b+""&&d[e][0].getAttribute("box-dis-y")===a+""&&c++;return c?!1:!0},getBoxArr:function(){var a=this.parentNode.getElementsByTagName("img"),b=[];for(i=0;i<a.length;i++)if("box"===a[i].getAttribute("class")){var c=[];c[0]=a[i],c[1]=a[i].getAttribute("box-dis-x"),c[2]=a[i].getAttribute("box-dis-y"),b.push(c)}return b},getBoxPact:function(a){for(var b=this.getBoxArr(),c=-1,d=0;d<b.length;d++)if(this.impact(a,b[d])){c=d;break}return c>=0?{checkBox:!0,ImgNode:b[c]}:{checkBox:!1}},checkMove:function(a,b){return 2===this.shut[this.pass].map[b][a]||3===this.shut[this.pass].map[b][a]?!1:!0},eventKey:function(a){var b=this;document.onkeydown=function(c){var d=c||window.event;switch(d.keyCode){case 37:a.style.backgroundPosition="-81px 0",b.runPerson(a,"L");break;case 38:a.style.backgroundPosition="-54px 0",b.runPerson(a,"T");break;case 39:a.style.backgroundPosition="-27px 0",b.runPerson(a,"R");break;case 40:a.style.backgroundPosition="0 0",b.runPerson(a,"D")}}},showBox:function(a,b,c,d){if(0!==c){var e=document.createElement("img");e.style.top=a*this.W+"px",e.style.left=b*this.H+"px",d&&(e.className=d,e.setAttribute("box-dis-x",b),e.setAttribute("box-dis-y",a)),e.src="images/"+c+".jpg",this.parentNode.appendChild(e)}},impact:function(a,b){return a.getAttribute("data-run-x")===b[1]&&a.getAttribute("data-run-y")===b[2]?!0:!1}};